<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì˜¤ì§•ì–´ ê²Œì„ ë¯¸ë¡œ - ë©ˆì¶”ë©´ ì£½ìŒ!</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Roboto', sans-serif; }
        #ui {
            position: absolute; top: 20px; left: 20px;
            color: white; background: rgba(0,0,0,0.8);
            padding: 15px; border-radius: 10px; border: 2px solid #ff004f; /* ì˜¤ì§•ì–´ ê²Œì„ í…Œë§ˆ ìƒ‰ìƒ */
            z-index: 10; pointer-events: none;
        }
        #insult-text {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #ffde00; /* ê²½ê³ ìƒ‰ */
            font-size: 3.5rem; font-weight: bold;
            text-shadow: 0 0 15px #ff004f; /* ì˜¤ì§•ì–´ ê²Œì„ í…Œë§ˆ ìƒ‰ìƒ */
            opacity: 0; transition: opacity 0.2s;
            pointer-events: none; text-align: center; width: 100%; z-index: 20;
        }
        #crosshair {
            position: absolute; top: 50%; left: 50%;
            width: 8px; height: 8px; background: rgba(255, 255, 255, 0.8);
            border-radius: 50%; transform: translate(-50%, -50%);
            pointer-events: none; border: 1px solid black;
        }
    </style>
</head>
<body>

    <div id="ui">
        <h2 style="margin:0; color: #ff004f;">ğŸ”´ ì˜¤ì§•ì–´ ê²Œì„ ë¯¸ë¡œ</h2>
        <p>ê·œì¹™: <b>í´ë¦­ ìœ ì§€</b> ì‹œì—ë§Œ ì „ì§„</p>
        <p>í˜ë„í‹°: <b>í´ë¦­ í•´ì œ</b> ì‹œ ì²˜ìŒìœ¼ë¡œ ì†Œí™˜</p>
        <p style="color: #ffde00;">ìƒì¡´ì„ ìœ„í•´ ì „ì§„í•˜ì„¸ìš”!</p>
    </div>

    <div id="insult-text">ë²½ì´ë‘ ëŒ€í™”í•˜ë‹ˆ? ğŸ§±</div>
    <div id="crosshair"></div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- í…ìŠ¤ì²˜ ë¡œë” (ë²½ì— í…ìŠ¤ì²˜ ì ìš©ì„ ìœ„í•´ í•„ìš”) ---
        const textureLoader = new THREE.TextureLoader();
        const wallTexture = textureLoader.load('https://threejs.org/examples/textures/hardwood2_diffuse.jpg'); // ê±°ì¹œ ë²½ í…ìŠ¤ì²˜ ì˜ˆì‹œ
        wallTexture.wrapS = wallTexture.wrapT = THREE.RepeatWrapping;
        wallTexture.repeat.set(1, 1); // í…ìŠ¤ì²˜ ë°˜ë³µ íšŸìˆ˜

        // --- ì´ˆê¸° ì„¤ì • ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a0a); // ì–´ë‘ìš´ ë°°ê²½
        scene.fog = new THREE.Fog(0x400000, 1, 35); // ë¶„í™ìƒ‰ ì•ˆê°œ

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- ì¡°ëª… ---
        const ambLight = new THREE.AmbientLight(0xffffff, 0.2); // ì£¼ë³€ê´‘ ì¤„ì„
        scene.add(ambLight);
        const playerLight = new THREE.PointLight(0xff004f, 150, 15); // í”Œë ˆì´ì–´ ë¼ì´íŠ¸ ìƒ‰ìƒ ë³€ê²½
        camera.add(playerLight);
        scene.add(camera);

        // --- ë¯¸ë¡œ ë°ì´í„° ---
        const M_SIZE = 4; // ë²½ í•˜ë‚˜ë‹¹ ì‹¤ì œ í¬ê¸°
        const maze = [
            [1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,1,0,0,1],
            [1,0,1,1,1,0,1,0,0,1],
            [1,0,0,0,1,0,1,1,0,1],
            [1,1,1,0,1,0,0,0,0,1],
            [1,0,0,0,0,1,1,1,0,1],
            [1,0,1,1,0,0,0,1,0,1],
            [1,0,0,1,1,1,0,0,0,1],
            [1,1,0,0,0,0,0,1,0,1],
            [1,1,1,1,1,1,1,1,1,1],
        ];

        const walls = [];
        const wallGeo = new THREE.BoxGeometry(M_SIZE, 6, M_SIZE);
        const wallMat = new THREE.MeshStandardMaterial({ map: wallTexture, color: 0x444444 }); // í…ìŠ¤ì²˜ì™€ ì–´ë‘ìš´ ìƒ‰ìƒ ì¡°í•©

        maze.forEach((row, z) => {
            row.forEach((cell, x) => {
                if(cell === 1) {
                    const wall = new THREE.Mesh(wallGeo, wallMat);
                    wall.position.set(x * M_SIZE, 3, z * M_SIZE);
                    scene.add(wall);
                    walls.push(wall);
                }
            });
        });

        // ë°”ë‹¥ (ì§™ì€ ë…¹ìƒ‰)
        const floor = new THREE.Mesh(
            new THREE.PlaneGeometry(200, 200),
            new THREE.MeshStandardMaterial({ color: 0x224422 })
        );
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        // --- ìºë¦­í„° ì„¤ì • ---
        const startPos = new THREE.Vector3(M_SIZE, 1.6, M_SIZE);
        camera.position.copy(startPos);
        let isMoving = false;
        const playerRadius = 0.8;

        // --- ì´ë²¤íŠ¸ ---
        const insultText = document.getElementById('insult-text');
        const insults = [
            "ğŸ”´ íƒˆë½ì…ë‹ˆë‹¤!",
            "ê²Œì„ ì˜¤ë²„. ë„Œ íƒˆë½ì´ì•¼.",
            "ì†ê°€ë½ì´ ë¯¸ë„ëŸ¬ì¡Œêµ°, í”Œë ˆì´ì–´.",
            "ì‹¤ë§ì´êµ°, ë‹¤ìŒ ê¸°íšŒì—...",
            "ì‘, ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•´~ ğŸ˜ˆ",
            "ë²½ì´ë‘ ì‚¬ë‘ì— ë¹ ì¡Œë‹ˆ? ğŸ’–",
            "í¬ê¸°í•˜ë©´ í¸í•´! (ì§„ì§œë¡œ)",
            "ë„ˆ ì§€ê¸ˆ í‚¹ë°›ì•˜ì§€?"
        ];

        function showInsult() {
            insultText.innerText = insults[Math.floor(Math.random()*insults.length)];
            insultText.style.opacity = '1';
            setTimeout(() => insultText.style.opacity = '0', 1000);
        }

        window.addEventListener('mousedown', (e) => { if(e.button === 0) isMoving = true; });
        window.addEventListener('mouseup', (e) => { 
            if(e.button === 0 && isMoving) {
                isMoving = false;
                camera.position.copy(startPos); // ë¦¬ì…‹
                yaw = 0; pitch = 0;
                camera.rotation.set(0, 0, 0);
                showInsult();
            }
        });

        document.body.addEventListener('click', () => document.body.requestPointerLock());

        let yaw = 0, pitch = 0;
        window.addEventListener('mousemove', (e) => {
            if (document.pointerLockElement === document.body) {
                yaw -= e.movementX * 0.002;
                pitch -= e.movementY * 0.002;
                pitch = Math.max(-Math.PI/2.5, Math.min(Math.PI/2.5, pitch));
                camera.rotation.set(pitch, yaw, 0, 'YXZ');
            }
        });

        // --- ì¶©ëŒ ê°ì§€ ë¡œì§ ---
        function checkCollision(nextPos) {
            for (let wall of walls) {
                const dx = Math.abs(nextPos.x - wall.position.x);
                const dz = Math.abs(nextPos.z - wall.position.z);
                if (dx < (M_SIZE / 2 + playerRadius) && dz < (M_SIZE / 2 + playerRadius)) {
                    return true;
                }
            }
            return false;
        }

        // --- ë£¨í”„ ---
        function animate() {
            requestAnimationFrame(animate);

            if (isMoving) {
                const dir = new THREE.Vector3();
                camera.getWorldDirection(dir);
                dir.y = 0; 
                dir.normalize();

                const speed = 0.12;
                const nextPos = camera.position.clone().addScaledVector(dir, speed);

                if (!checkCollision(nextPos)) {
                    camera.position.copy(nextPos);
                } else {
                    // ë²½ì— ë¶€ë”ªí˜”ì„ ë•Œë„ ì•½ ì˜¬ë¦¬ëŠ” ë©˜íŠ¸ë¥¼ ë„ìš°ê³  ì‹¶ë‹¤ë©´ ì—¬ê¸°ì— showInsult() ì¶”ê°€
                    // showInsult(); 
                }
            }
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
