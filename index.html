<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Squid Game</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; color: white; pointer-events: none; }
        #status { font-size: 3rem; font-weight: bold; text-shadow: 2px 2px #000; }
        .red { color: #ff4757; }
        .green { color: #2ed573; }

        /* ê²°ê³¼ ì°½ */
        #overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); flex-direction: column; align-items: center; 
            justify-content: center; color: white; z-index: 100;
        }
        #overlay h1 { font-size: 4rem; margin: 0; }
        #retryBtn { 
            margin-top: 20px; padding: 15px 40px; font-size: 1.5rem; 
            cursor: pointer; background: white; border: none; border-radius: 10px; 
        }
    </style>
</head>
<body>

    <div id="ui">
        <div id="status" class="green">READY</div>
        <p>í™”ë©´ì„ ê¸¸ê²Œ ëˆ„ë¥´ë©´ ì „ì§„í•©ë‹ˆë‹¤!</p>
    </div>

    <div id="overlay">
        <h1 id="resTitle">ELIMINATED!</h1>
        <p id="resMsg">ë°”ë³´ì•¼~ ì›€ì§ì˜€ì§€ë¡±!!</p>
        <button id="retryBtn" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // 1. ê¸°ë³¸ ì…‹íŒ… (Scene, Camera, Renderer)
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // í•˜ëŠ˜ìƒ‰

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10); // ë’¤ìª½ ìœ„ì—ì„œ ë‚´ë ¤ë‹¤ë³´ëŠ” ì‹œì 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // ì¡°ëª…
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(0, 10, 10);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0x404040));

        // 2. ì˜¤ë¸Œì íŠ¸ ìƒì„±
        // ë°”ë‹¥ (ëª¨ë˜ì‚¬ì¥ ëŠë‚Œ)
        const floorGeo = new THREE.PlaneGeometry(20, 100);
        const floorMat = new THREE.MeshStandardMaterial({ color: 0xedc9af });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // ê²°ìŠ¹ì„  (ë¶„í™ìƒ‰ ì„ )
        const lineGeo = new THREE.PlaneGeometry(20, 0.5);
        const lineMat = new THREE.MeshStandardMaterial({ color: 0xff007f });
        const goalLine = new THREE.Mesh(lineGeo, lineMat);
        goalLine.rotation.x = -Math.PI / 2;
        goalLine.position.y = 0.01;
        goalLine.position.z = -40; // ëª©í‘œ ì§€ì 
        scene.add(goalLine);

        // í”Œë ˆì´ì–´ (êµ¬ì²´)
        const playerGeo = new THREE.SphereGeometry(0.5, 32, 32);
        const playerMat = new THREE.MeshStandardMaterial({ color: 0x0061ff });
        const player = new THREE.Mesh(playerGeo, playerMat);
        player.position.y = 0.5;
        player.position.z = 5; // ì‹œì‘ ì§€ì 
        scene.add(player);

        // ìˆ ë˜ (ë¨¸ë¦¬ë§Œ ìˆëŠ” ê°„ë‹¨í•œ ì¸í˜• ì»¨ì…‰)
        const dollGeo = new THREE.BoxGeometry(1, 1, 1);
        const dollMat = new THREE.MeshStandardMaterial({ color: 0xff4757 });
        const doll = new THREE.Mesh(dollGeo, dollMat);
        doll.position.set(0, 1, -45);
        scene.add(doll);

        // 3. ê²Œì„ ë¡œì§ ë³€ìˆ˜
        let isMoving = false;
        let isRedLight = true;
        let gameOver = false;
        const statusEl = document.getElementById('status');

        // ì…ë ¥ ê°ì§€ (í„°ì¹˜/ë§ˆìš°ìŠ¤)
        const startMove = () => { if(!gameOver) isMoving = true; };
        const endMove = () => { isMoving = false; };

        window.addEventListener('mousedown', startMove);
        window.addEventListener('mouseup', endMove);
        window.addEventListener('touchstart', startMove);
        window.addEventListener('touchend', endMove);

        // ì‹ í˜¸ë“± ë¡œì§
        function toggleLight() {
            if (gameOver) return;
            isRedLight = !isRedLight;
            if (isRedLight) {
                statusEl.textContent = "ğŸ›‘ RED LIGHT";
                statusEl.className = "red";
                doll.rotation.y = 0; // ìˆ ë˜ê°€ ì³ë‹¤ë´„
                setTimeout(toggleLight, 1000 + Math.random() * 1500);
            } else {
                statusEl.textContent = "ğŸƒ GREEN LIGHT";
                statusEl.className = "green";
                doll.rotation.y = Math.PI; // ìˆ ë˜ê°€ ë’¤ëŒì•„ë´„
                setTimeout(toggleLight, 2000 + Math.random() * 2000);
            }
        }
        setTimeout(toggleLight, 1000);

        // 4. ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);

            if (!gameOver) {
                if (isMoving) {
                    if (isRedLight) {
                        endGame(false);
                    } else {
                        player.position.z -= 0.15; // ì•ìœ¼ë¡œ ì „ì§„
                        // ì¹´ë©”ë¼ê°€ í”Œë ˆì´ì–´ë¥¼ ë”°ë¼ê°€ê²Œ í•¨
                        camera.position.z = player.position.z + 5;
                    }
                }

                // ìŠ¹ë¦¬ íŒì •
                if (player.position.z <= -40) {
                    endGame(true);
                }
            }
            renderer.render(scene, camera);
        }

        function endGame(success) {
            gameOver = true;
            isMoving = false;
            document.getElementById('overlay').style.display = 'flex';
            if (success) {
                document.getElementById('resTitle').textContent = "SUCCESS! ğŸ‰";
                document.getElementById('resMsg').textContent = "ì‚´ì•„ë‚¨ìœ¼ì…¨êµ°ìš”!";
            } else {
                document.getElementById('resTitle').textContent = "ELIMINATED! ğŸ”«";
                document.getElementById('resMsg').textContent = "ë°”ë³´ì•¼~ ì›€ì§ì˜€ì§€ë¡±!!";
            }
        }

        animate();

        // í™”ë©´ í¬ê¸° ì¡°ì ˆ ëŒ€ì‘
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
